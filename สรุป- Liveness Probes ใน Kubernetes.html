<!doctype html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สรุป: Liveness Probes ใน Kubernetes</title>
    <style>
        /* --- ตัวแปรกลาง --- */
        :root {
            --bg-color: #f8fafc;
            --text-color: #334155;
            --primary-color: #4f46e5;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --code-bg: #f3f4f6;
            --heading-color: #111827;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --info-bg: #eff6ff;
            --info-border: #93c5fd;
            --font-family: 'Inter', 'Noto Sans Thai', sans-serif;
        }

        /* --- Reset และค่าเริ่มต้น --- */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.7;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            padding: 2rem;
        }

        /* --- โครงสร้างหลัก --- */
        .container {
            width: 100%;
            max-width: 1024px;
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        header {
            padding: 2rem 2.5rem;
            background-color: var(--heading-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        header svg {
            flex-shrink: 0;
            color: var(--primary-color);
        }

        main {
            padding: 2.5rem;
        }
        
        section {
            margin-bottom: 3rem;
        }
        
        section:last-child {
            margin-bottom: 0;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
            color: #6b7280;
            background-color: #f9fafb;
            border-top: 1px solid var(--border-color);
        }

        /* --- องค์ประกอบตัวอักษร --- */
        h1 {
            margin: 0;
            font-size: 2.1rem;
            font-weight: 700;
        }

        h2 {
            font-size: 1.75rem;
            color: var(--heading-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.75rem;
            margin-top: 0;
            margin-bottom: 1.5rem;
        }
        
        p, li {
            font-size: 1rem;
            color: #4b5563;
        }

        code {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            background-color: var(--code-bg);
            padding: 0.2em 0.5em;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        strong {
           color: var(--heading-color);
           font-weight: 600;
        }

        /* --- ส่วนประกอบ UI --- */
        .info-box {
            background-color: var(--info-bg);
            border-left: 4px solid var(--info-border);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .probe-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .probe-card {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            background-color: #f9fafb;
        }
        
        .probe-card h3 {
            margin-top: 0;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--heading-color);
        }

        .probe-card ul {
            list-style: none;
            padding-left: 0;
            font-size: 0.95rem;
        }
        
        .probe-card li {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            align-items: flex-start;
        }
        
        .probe-card li svg {
            flex-shrink: 0;
            margin-top: 5px;
        }
        
        .success-item svg { color: var(--success-color); }
        .failure-item svg { color: var(--danger-color); }

        /* --- Canvas --- */
        canvas {
            display: block;
            width: 100%;
            margin: 2rem auto 0;
            border-radius: 12px;
            background-color: #f9fafb;
            border: 1px solid var(--border-color);
        }
        
        /* --- Responsive --- */
        @media (max-width: 768px) {
            body { padding: 1rem; }
            main, header { padding: 1.5rem; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.5rem; }
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M22 12H18L15 21L9 3L6 12H2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div>
                 <h1>Liveness Probes</h1>
                 <p style="margin:0; opacity: 0.9;">กลไกตรวจสอบสถานะ "ความเป็นอยู่" ของ Container</p>
            </div>
        </header>

        <main>
            <section id="intro">
                <h2>Liveness Probes คืออะไร?</h2>
                <p>
                    <strong><code>Liveness Probes</code></strong> คือกลไกที่ Kubernetes ใช้เพื่อตรวจสอบว่า <code>container</code> ยังคง "มีชีวิต" และทำงานได้ดีอยู่หรือไม่ เราสามารถกำหนดค่า <code>liveness probe</code> ให้กับแต่ละ <code>container</code> ในไฟล์ <code>specification</code> ของ <code>pod</code> ได้เลย โดย Kubernetes จะทำการเรียกใช้ <code>probe</code> นี้เป็นระยะๆ และถ้าหาก <code>probe</code> ล้มเหลว (fail) Kubernetes ก็จะทำการ **รีสตาร์ท <code>container</code>** นั้นให้ทันที
                </p>
                 <div class="info-box">
                    <p><strong>ข้อควรรู้:</strong> Kubernetes ยังมี <strong><code>Readiness Probes</code></strong> ด้วย ซึ่งใช้เพื่อตรวจสอบว่า Container "พร้อม" ที่จะรับ traffic หรือยัง เป็นคนละวัตถุประสงค์กัน อย่าสับสนนะครับ!</p>
                </div>
            </section>
            
            <section id="probe-types">
                <h2>รูปแบบการตรวจสอบ 3 ประเภท</h2>
                <div class="probe-types-grid">
                    <article class="probe-card">
                        <h3>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M12 2L12 12L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M20 12C20 16.4183 16.4183 20 12 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                            HTTP GET Probe
                        </h3>
                        <p>ยิง <code>HTTP GET request</code> ไปยัง <code>IP address</code>, <code>port</code>, และ <code>path</code> ที่กำหนด</p>
                        <ul>
                            <li class="success-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                <strong>สำเร็จ:</strong> ได้รับ Response Code กลุ่ม 2xx หรือ 3xx
                            </li>
                            <li class="failure-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                <strong>ล้มเหลว:</strong> ได้รับ Error Code หรือไม่ตอบสนอง
                            </li>
                        </ul>
                    </article>
                    <article class="probe-card">
                        <h3>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M20 21V19C20 16.7909 18.2091 15 16 15H8C5.79086 15 4 16.7909 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                           TCP Socket Probe
                        </h3>
                        <p>พยายามเปิด <code>TCP connection</code> ไปยัง <code>port</code> ของ Container ที่ระบุไว้</p>
                        <ul>
                            <li class="success-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                <strong>สำเร็จ:</strong> สามารถสร้าง Connection ได้
                            </li>
                             <li class="failure-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                <strong>ล้มเหลว:</strong> ไม่สามารถเชื่อมต่อได้
                            </li>
                        </ul>
                    </article>
                     <article class="probe-card">
                        <h3>
                             <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M10 21H4C3.46957 21 2.96086 20.7893 2.58579 20.4142C2.21071 20.0391 2 19.5304 2 19V5C2 4.46957 2.21071 3.96086 2.58579 3.58579C2.96086 3.21071 3.46957 3 4 3H10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 15L19 12L14 9V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            Exec Probe
                        </h3>
                        <p>รันคำสั่ง (command) ภายใน Container และตรวจสอบ <code>exit status code</code></p>
                         <ul>
                            <li class="success-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                <strong>สำเร็จ:</strong> Exit status code เป็น <code>0</code>
                            </li>
                             <li class="failure-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                <strong>ล้มเหลว:</strong> Exit status code เป็นค่าอื่น
                            </li>
                        </ul>
                    </article>
                </div>
            </section>
            
            <section id="diagram">
                <h2>ภาพรวมการทำงาน</h2>
                 <canvas id="probeFlowDiagram" width="900" height="250" aria-label="ไดอะแกรมแสดงขั้นตอนการทำงานของ Liveness Probe โดย Kubelet จะส่ง Probe ไปยัง Container หากสำเร็จจะตรวจสอบใหม่ในรอบถัดไป หากล้มเหลว Container จะถูกรีสตาร์ท"></canvas>
            </section>

        </main>
    </div>

    <script>
        /**
         * Utility functions สำหรับวาดบน Canvas
         * ฟังก์ชันเหล่านี้ถูกออกแบบให้เป็น pure functions เพื่อลด side-effects
         */

        // --- ค่าคงที่สำหรับ Styles ---
        const COLORS = {
            PRIMARY: '#4f46e5',
            SUCCESS: '#10b981',
            DANGER: '#ef4444',
            TEXT: '#334155',
            BORDER: '#e5e7eb',
            BG_LIGHT: '#f9fafb',
            BG_SUCCESS: '#ecfdf5',
            BG_DANGER: '#fef2f2',
        };
        const FONT_NORMAL = '13px var(--font-family)';
        const FONT_BOLD = 'bold 14px var(--font-family)';

        /**
         * วาดกล่องสี่เหลี่ยมโค้งมน
         * @param {CanvasRenderingContext2D} ctx - Context ของ canvas
         * @param {{x: number, y: number, w: number, h: number}} pos - ตำแหน่งและขนาด
         * @param {string} text - ข้อความ
         * @param {{fill: string, stroke: string}} style - Object สี
         */
        const drawBox = (ctx, pos, text, style) => {
            const { x, y, w, h } = pos;
            const r = 8; // รัศมีความโค้ง
            ctx.fillStyle = style.fill;
            ctx.strokeStyle = style.stroke;
            ctx.lineWidth = 1.5;

            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            ctx.fillStyle = COLORS.TEXT;
            ctx.font = FONT_BOLD;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, x + w / 2, y + h / 2);
        };
        
        /**
         * วาดลูกศร
         * @param {CanvasRenderingContext2D} ctx - Context ของ canvas
         * @param {{x: number, y: number}} from - จุดเริ่มต้น
         * @param {{x: number, y: number}} to - จุดสิ้นสุด
         * @param {string} label - ข้อความบนลูกศร
         */
        const drawArrow = (ctx, from, to, label) => {
            const headlen = 10;
            const angle = Math.atan2(to.y - from.y, to.x - from.x);
            
            ctx.strokeStyle = COLORS.TEXT;
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(from.x, from.y);
            ctx.lineTo(to.x, to.y);
            ctx.stroke();
            
            // วาดหัวลูกศร
            ctx.beginPath();
            ctx.moveTo(to.x, to.y);
            ctx.lineTo(to.x - headlen * Math.cos(angle - Math.PI / 6), to.y - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(to.x - headlen * Math.cos(angle + Math.PI / 6), to.y - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fillStyle = COLORS.TEXT;
            ctx.fill();

            // วาดข้อความ
            ctx.font = FONT_NORMAL;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'bottom';
            ctx.fillText(label, from.x + (to.x - from.x) / 2, from.y + (to.y - from.y) / 2 - 5);
        };
        
        /**
         * ฟังก์ชันหลักสำหรับวาดไดอะแกรม
         * @param {HTMLCanvasElement} canvasEl - Element ของ canvas
         */
        const renderProbeFlowDiagram = (canvasEl) => {
            if (!canvasEl || !canvasEl.getContext) return;
            const ctx = canvasEl.getContext('2d');
            const centerY = canvasEl.height / 2;
            
            // ตำแหน่งของกล่องต่างๆ
            const kubeletPos = { x: 50, y: centerY - 30, w: 120, h: 60 };
            const containerPos = { x: 270, y: centerY - 30, w: 140, h: 60 };
            const successPos = { x: 510, y: 50, w: 120, h: 60 };
            const failPos = { x: 510, y: 140, w: 120, h: 60 };
            const restartPos = { x: 730, y: 140, w: 120, h: 60 };

            // 1. วาดกล่อง
            drawBox(ctx, kubeletPos, 'Kubelet', { fill: COLORS.BG_LIGHT, stroke: COLORS.BORDER });
            drawBox(ctx, containerPos, 'Container', { fill: COLORS.BG_LIGHT, stroke: COLORS.BORDER });
            drawBox(ctx, successPos, 'Success', { fill: COLORS.BG_SUCCESS, stroke: COLORS.SUCCESS });
            drawBox(ctx, failPos, 'Fail', { fill: COLORS.BG_DANGER, stroke: COLORS.DANGER });
            drawBox(ctx, restartPos, 'Restart', { fill: COLORS.BG_DANGER, stroke: COLORS.DANGER });
            
            // 2. วาดลูกศร
            drawArrow(ctx, { x: kubeletPos.x + kubeletPos.w, y: centerY }, { x: containerPos.x, y: centerY }, 'Probe');
            
            // 3. วาดเส้นทางจาก Container
            ctx.beginPath();
            ctx.moveTo(containerPos.x + containerPos.w, centerY);
            ctx.lineTo(containerPos.x + containerPos.w + 20, centerY);
            ctx.lineTo(containerPos.x + containerPos.w + 20, successPos.y + successPos.h / 2);
            ctx.lineTo(successPos.x, successPos.y + successPos.h / 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(containerPos.x + containerPos.w + 20, centerY);
            ctx.lineTo(containerPos.x + containerPos.w + 20, failPos.y + failPos.h / 2);
            ctx.lineTo(failPos.x, failPos.y + failPos.h / 2);
            ctx.stroke();

            drawArrow(ctx, { x: failPos.x + failPos.w, y: failPos.y + failPos.h / 2 }, { x: restartPos.x, y: restartPos.y + restartPos.h / 2 }, '');
        };
        
        // --- การทำงานหลักหลัง DOM โหลดเสร็จ ---
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('probeFlowDiagram');
            renderProbeFlowDiagram(canvas);
        });
    </script>
</body>
</html>